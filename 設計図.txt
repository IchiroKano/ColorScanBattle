プレイヤー２人による対戦バトル
ーーーーーーーーーーーーーーーー
■ゲームの進行ステップ：
　ステップ１．ステージング：プレイヤー１と２のjsonファイルを読み込む（リロードボタン）、終了ボタン、戦闘開始ボタン
　ステップ２．戦闘シーン：最大７回のターンでhpがゼロになるか、7ターン終了まで戦闘を繰り返す
　ステップ３．結果：プレイヤー１と２のどちらが勝ったか（hpが大きい方が勝ち）結果を画面表示する。ステージングに戻るボタン

■戦闘シーンの流れ：
　１．ターン数を表示する（ターン数は最大７）
　２．プレイヤー１と２、それぞれアクションを乱数で決める　["攻撃", "防御", "回復", "魔法", "ジャンプ"]
　３．プレイヤーのアクションは、生成AIで実況コメントを生成する（非同期処理）。
　４．プレイヤーのエフェクト（アニメ）を描画し、戦闘アクションを表現している。エフェクト実行後にHPパラメータグラフを更新。この間に、実況コメントが返ってきたら、画面に実況コメントを描画する。
　５．hpがゼロなら戦闘シーンを終了する
　６．１に戻る

---------------------- ノートPC
curl -X POST http://localhost:11434/api/generate -H "Content-Type: application/json" -d "{\"model\":\"granite4:350m-h\",\"prompt\":\"日本の秋について教えてください\",\"stream\":false}"

--------------------- ワークフロー

■1. 起動時の初期化処理
概要
ゲームの起動時に必要なリソースや設定を初期化します。

処理内容
音量設定:
set_volume(default_volume) を呼び出して音量を設定。
インスタンスの初期化:
GameState, PlayerManager, EventManager, StageRenderer などの主要クラスのインスタンスを生成。
プレイヤーデータのロード:
player_manager.load_player("player1") と player_manager.load_player("player2") を呼び出して、プレイヤー1とプレイヤー2のデータをロード。
効果音とログファイルの初期化:
load_sounds() で効果音をロード。
initialize_log_file() でログファイルを空にする。
画面設定:
Pygame を使用してフルスクリーンモードでウィンドウを生成。
フォントやアイコンを設定。
起動時の音楽再生:
music_files['startup'] を再生。

■2. メインループ (main_loop)
概要
ゲームのメインループで、ステージング、戦闘、結果表示の各ステージを管理します。

処理内容
イベント取得:
pygame.event.get() を使用して、ユーザー入力やシステムイベントを取得。
ステージごとの処理:
ステージング (staging):
stage_renderer.draw_staging() を呼び出してステージング画面を描画。
プレイヤーデータのリロードや戦闘開始ボタンの処理を実行。
戦闘 (battle):
battle_manager.advance_step() を呼び出して戦闘ステップを進行。
draw_battle() を呼び出して戦闘画面を描画。
実況コメントを生成 (log_update_live_commentary)。
戦闘終了判定を行い、結果画面に遷移。
結果表示 (result):
stage_renderer.draw_result() を呼び出して結果画面を描画。
再起動ボタンの処理を実行。
画面更新:
pygame.display.update() を呼び出して画面を更新。
フレームレート制御:
clock.tick(30) でフレームレートを 30FPS に設定。

■3. ステージング (stage_renderer.draw_staging)
概要
ステージング画面を描画し、プレイヤーデータのリロードや戦闘開始ボタンを表示します。

処理内容
プレイヤー1とプレイヤー2の情報を画面に描画。
ボタン（リロード、終了、戦闘開始）を描画。
ボタンのクリックイベントを処理。

■4. 戦闘 (draw_battle)
概要
戦闘画面を描画し、プレイヤーのアクションやエフェクトを表示します。

処理内容
プレイヤー1とプレイヤー2のアクションを描画。
各アクションに応じたエフェクトを表示（例: 攻撃、魔法、防御、回復、ジャンプ）。
実況コメントを生成して画面に表示。
戦闘終了判定を行い、結果画面に遷移。

■5. 結果表示 (stage_renderer.draw_result)
概要
戦闘の結果を表示し、再起動や終了のボタンを描画します。

処理内容
プレイヤー1とプレイヤー2の最終ステータスを表示。
再起動ボタンや終了ボタンを描画。
ボタンのクリックイベントを処理。

■6. 実況コメント生成 (update_live_commentary_if_needed)
概要
ターン更新時に実況コメントを生成します。

処理内容
プレイヤーの行動や残りHPを基に差分プロンプトを生成。
generate_live_commentary_async を呼び出して実況コメントを生成。
実況コメントをログに出力。

■7. 再起動処理
概要
ゲームをリセットしてステージング画面に戻します。

処理内容
game_state.reset() を呼び出してゲーム状態をリセット。
player_manager.load_player() を呼び出してプレイヤーデータを再ロード。
ステージを staging に設定。

■8. プログラム終了
概要
ゲームを終了します。

処理内容
pygame.quit() を呼び出して Pygame を終了。
os._exit(0) を呼び出してプロセスを強制終了。
補足
エラー処理:
JSON ファイルの読み込みや音楽再生でエラーが発生した場合、ログにエラーメッセージを出力。
非同期処理:
実況コメント生成は非同期で実行され、ターン更新時にのみ呼び出されます。